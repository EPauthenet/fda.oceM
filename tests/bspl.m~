function [fdobj] = bspl(Xi,Pi,nbas,fdn)
% Fit of B-splines on Multivariate profiles
%
% Xi : array containing the levels * stations * variables
% Pi : vector containing the levels
% nbas : number of Bsplines (coefficients)
% fdn : a list of the variable names, for example {'Temperature','Salinity'}
%
% Authors : 
% Etienne Pauthenet \email{<etienne.pauthenet@gmail.com>}, David Nerini \code{<david.nerini@univ-amu.fr>}, Fabien Roquet \code{<fabien.roquet@gu.se>}
% References : 
% Pauthenet et al. (2017) A linear decomposition of the Southern Ocean thermohaline structure. Journal of Physical Oceanography, http://dx.doi.org/10.1175/JPO-D-16-0083.1
% Ramsay J. O., and B. W. Silverman, 2005: Functional Data Analysis. Springer, 426 pp.

% @seealso \code{\link{fpca}} for functional principal component analysis of T-S profiles, \code{\link{PCmap}} for plotting a map of PC, \code{\link{kde_pc}} for kernel density estimation of two PCs...

prange = [Pi(1) Pi(end)];
Breaks=prange(1)+(prange(2)-prange(1))*tan(0:1/(nbas-3):1)'/tan(1);
basis = create_bspline_basis(prange,nbas,4,Breaks);

fdobj = data2fd(Pi,Xi,basis,fdnames);
